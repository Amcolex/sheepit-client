<?xml version="1.0"?>

<project name="sheepit-renderfarm-client" default="client">
    <property name="compile.debug" value="true"/>
    <property name="compile.deprecation" value="true"/>
    <property name="compile.optimize" value="true"/>
    <property name="compile.version" value="1.7"/>
    <property name="compile.release" value="5.0.0"/>
    
    <target name="precompile">
        <antcall target="clean" />
        
        <mkdir dir="build"/>
        <mkdir dir="bin"/>
        <echo file="build/VERSION" message="${compile.release}" />
    </target>
    
    <target name="client">
        <antcall target="precompile" />
        <javac srcdir="src"
               destdir="build"
               target="${compile.version}"
               source="${compile.version}"
               debug="${compile.debug}"
               optimize="${compile.optimize}"
               deprecation="${compile.deprecation}"
               includes="**">
               <classpath>
                     <pathelement location="extern/args4j.jar"/>
                     <pathelement location="extern/servlet-api.jar"/>
                     <pathelement location="extern/jetty-util.jar"/>
                     <pathelement location="extern/jetty-servlets.jar"/>
                     <pathelement location="extern/jetty-servlet.jar"/>
                     <pathelement location="extern/jetty-server.jar"/>
                     <pathelement location="extern/jetty-io.jar"/>
                     <pathelement location="extern/jetty-http.jar"/>
                     <pathelement location="extern/jetty-client.jar"/>
                     <pathelement location="extern/httpclient.jar"/>
                     <pathelement location="extern/httpcore.jar"/>
               </classpath>
        </javac>
        
        <unjar dest="build">
            <filelist dir="." files="extern/args4j.jar" />
            <filelist dir="." files="extern/servlet-api.jar" />
            <filelist dir="." files="extern/jetty-util.jar" />
            <filelist dir="." files="extern/jetty-servlets.jar" />
            <filelist dir="." files="extern/jetty-servlet.jar" />
            <filelist dir="." files="extern/jetty-server.jar" />
            <filelist dir="." files="extern/jetty-io.jar" />
            <filelist dir="." files="extern/jetty-http.jar" />
            <filelist dir="." files="extern/jetty-client.jar" />
            <filelist dir="." files="extern/httpclient.jar"/>
            <filelist dir="." files="extern/httpcore.jar"/>

        </unjar>
        
        <copy file="resources/icon.png" tofile="build/icon.png" overwrite="true" />
        <copy file="resources/title.png" tofile="build/title.png" overwrite="true" />
        
        <jar destfile="bin/sheepit-proxy.jar"
            basedir="build/">
            <include name="**"/>
            <manifest>
                <attribute name="Main-Class" value="com.sheepit.proxy.main.Main"/>
                <attribute name="Application-Name" value="SheepIt-client-proxy"/>
                <attribute name="Trusted-Library" value="true"/>
                <attribute name="Permissions" value="all-permissions"/>
                <attribute name="Codebase" value="*"/>
            </manifest>
        </jar>
    </target>
    
    <target name="clean" description="clean files">
        <delete dir="build"/>
        <delete dir="bin"/>
    </target>
 </project>

